<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="utf-8" />
	<title>tobias-barth.net | Moderne Webentwicklung aus Köln</title>
	<meta name="description" content="" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="stylesheet" href="/css/style.css" />
	<!--[if lt IE 9]>
		<link rel="stylesheet" href="/css/old-ie.css" />
	<![endif]-->

	<link rel="alternate" type="application/rss+xml" href="/blog/feed/rss.xml" />

</head>
<body>
	<header class="site-head">
			<a href="/"><h1 class="in-site-head">tobias-barth.net</h1>
			<p class="tagline in-site-head">Moderne Webentwicklung aus Köln</p></a>
		</header>


		<main>
			<nav class="main-navi" id="main-navi">
				<ul>
					<li><a href="/portfolio" title="Meine Fähigkeiten, Arbeitsfelder und Beispielprojekte"><span class="fa fa-wrench"></span> Ich mache</a></li>
				<li><a href="/blog" title="Mein Blog über Webentwicklung und Ähnliches"><span class="fa fa-pencil"></span> Ich schreibe</a></li>
<!--					<li><a href="" title="Lernen Sie mich besser kennen"><span class="fa fa-user"></span> Ich bin</a></li>-->
				</ul>
			</nav>
		<div class="blog-textcontainer">
<article id="Fix-speed-issue-when-writing-to-NAS-system" class="blog-post">
	<header class="blog-post-header">
	
		<h2 class="blog-post-title">Fix speed issue when writing to NAS system</h2>
	
	<p class="blog-post-date">Geschrieben am <time datetime="2019-05-03T09:36:54.000Z">03. Mai 2019</time></p>
	</header>
	<div class="blog-post-content">
		<p>I just fixed an issue with my FreeBSD home server. It is set up as a file server for Mac (AFP) and Linux Clients (NFS). My local network is Gigabit-based sothe limitating factor on read/write speeds should be the hard disk drives in the server.</p>
<p>The server has a Core i3-6100T CPU @ 3.20GHz, 8GB RAM, a ZFS setup with two mirror vdevs each consisting of two disks connected to the board via SATA3. And of course the onboard Gbit NIC (Realtek).</p>
<p>I know very well that write speed was at around 50–60MB/sec, which I would expect. But lately, it dropped amazingly to ~1MB/sec. And I just couldn’t think of, why. I suspected the cable, the AFP, the RAM anything.</p>
<p>What I didn’t suspect — until today, that is — was the network interface. But I had time today for some googling and even if I didn’t found the solution directly, I stumbled across something related to the output of <code>ifconfig</code>. So I hacked that into the console and stared at it.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">re0:</span> flags=<span class="number">8843</span>&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric <span class="number">0</span> mtu <span class="number">1500</span></span><br><span class="line">        options=<span class="number">8209</span>b&lt;RXCSUM,TXCSUM,VLAN_MTU,VLAN_HWTAGGING,VLAN_HWCSUM,WOL_MAGIC,LINKSTATE&gt;</span><br><span class="line">        ether <span class="number">4</span><span class="string">c:</span><span class="string">cc:</span><span class="number">6</span><span class="string">a:</span><span class="string">b3:</span><span class="number">3</span><span class="string">c:</span>f5</span><br><span class="line">        hwaddr <span class="number">4</span><span class="string">c:</span><span class="string">cc:</span><span class="number">6</span><span class="string">a:</span><span class="string">b3:</span><span class="number">3</span><span class="string">c:</span>f5</span><br><span class="line">        inet6 <span class="string">fd23:</span><span class="number">16</span>:<span class="number">7</span>:<span class="number">7</span>::<span class="number">1</span> prefixlen <span class="number">64</span></span><br><span class="line">        inet6 <span class="string">fe80:</span>:<span class="number">4</span><span class="string">ecc:</span><span class="number">6</span><span class="string">aff:</span><span class="string">feb3:</span><span class="number">3</span>cf5%re0 prefixlen <span class="number">64</span> scopeid <span class="number">0x1</span></span><br><span class="line">        inet <span class="number">192.168</span><span class="number">.10</span><span class="number">.118</span> netmask <span class="number">0xffffff00</span> broadcast <span class="number">192.168</span><span class="number">.10</span><span class="number">.255</span></span><br><span class="line">        nd6 options=<span class="number">21</span>&lt;PERFORMNUD,AUTO_LINKLOCAL&gt;</span><br><span class="line"><span class="symbol">        media:</span> Ethernet autoselect (<span class="number">10</span>baseT/UTP &lt;full-duplex&gt;)</span><br><span class="line"><span class="symbol">        status:</span> active</span><br></pre></td></tr></table></figure>
<p>Do you spot it? </p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">media:</span> Ethernet autoselect (<span class="number">10</span>baseT/UTP <span class="params">&lt;full-duplex&gt;</span>)</span><br></pre></td></tr></table></figure>
<p>Well, that is … unfortunate. The output of <code>ifconfig -m re0</code> gave me:</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">supported media:</span><br><span class="line">		media autoselect mediaopt flowcontrol</span><br><span class="line">		media autoselect</span><br><span class="line">		media <span class="number">1000</span>baseT mediaopt <span class="literal">full</span><span class="attr">-duplex</span>,flowcontrol,master</span><br><span class="line">		media <span class="number">1000</span>baseT mediaopt <span class="literal">full</span><span class="attr">-duplex</span>,flowcontrol</span><br><span class="line">		media <span class="number">1000</span>baseT mediaopt <span class="literal">full</span><span class="attr">-duplex</span>,master</span><br><span class="line">		media <span class="number">1000</span>baseT mediaopt <span class="literal">full</span><span class="attr">-duplex</span></span><br><span class="line">		media <span class="number">100</span>baseTX mediaopt <span class="literal">full</span><span class="attr">-duplex</span>,flowcontrol</span><br><span class="line">		media <span class="number">100</span>baseTX mediaopt <span class="literal">full</span><span class="attr">-duplex</span></span><br><span class="line">		media <span class="number">100</span>baseTX</span><br><span class="line">		media <span class="number">10</span>baseT/UTP mediaopt <span class="literal">full</span><span class="attr">-duplex</span>,flowcontrol</span><br><span class="line">		media <span class="number">10</span>baseT/UTP mediaopt <span class="literal">full</span><span class="attr">-duplex</span></span><br><span class="line">		media <span class="number">10</span>baseT/UTP</span><br><span class="line">		media <span class="literal">none</span></span><br></pre></td></tr></table></figure>
<p>So I ran <code>sudo ifconfig re0 media 1000baseTX mediaopt full-duplex</code> and it worked. After that I also ran <code>sudo ifconfig re0 media autoselect</code> which also set the media type to 1000baseT full-duplex. I have no idea why the system did that wrong (or when) but I will monitor what happens after the next reboot. Maybe I have to do some configuration but maybe it was just an hickup.</p>
<p>Speeds are up to 60MB/sec again.</p>

	</div>
</article>

</div>

		</main>
	<footer class="site-footer h-card" aria-describedby="dse">
		<h3 class="in-site-footer cta">Kontaktieren Sie mich</h3>
		<p class="in-site-footer">Email: <a href="mailto:contact@tobias-barth.net" rel="me" class="u-email">contact@tobias-barth.net</a><br />
		Telefon: <a href="tel:+4915111215929">+49 151 112 15 929</a></p>
		<p id="dse" class="in-site-footer">(Bitte beachten Sie vor der Kontaktaufnahme meine Datenschutzerklärung.)</p>
		<h3 class="in-site-footer cta">Finden Sie mich</h3>
		<p class="in-site-footer"><img class="sm u-photo" src="/images/Portrait.png" alt="Mein Avatar" /><a class="sm fa fa-adn" href="https://alpha.app.net/4nduril" rel="me"><span>App.net</span></a> <a class="sm fa fa-twitter" href="https://twitter.com/4nduril" rel="me"><span>Twitter</span></a> <a class="sm fa fa-github-square" href="https://github.com/4nduril" rel="me"><span>Github</span></a></p>
		<h3 class="in-site-footer">Impressum</h3>
		<p class="in-site-footer">Inhaltlich verantwortlich gemäß § 5 <abbr title="Telemediengesetz">TMG</abbr>:<br />
		<a href="http://tobias-barth.net" class="p-name u-url">Tobias&nbsp;Barth</a><br />
		<span class="p-street-address">Vincenzstr.&nbsp;25</span><br />
		<span class="p-locality p-postal-code">51065&nbsp;Köln</span></p>
		<p class="in-site-footer">USt-ID: DE304359556</p>
		<h4 class="in-site-footer">Fotos</h4>
		<p class="in-site-footer">&copy;&nbsp;<a href="http://annebarth.de">Anne&nbsp;Barth</a></p>
		<p class="in-site-footer"><a href="dse.html">Datenschutzerklärung</a></p>
	</footer>
</body>

</html>
