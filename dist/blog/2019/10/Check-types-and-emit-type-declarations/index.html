<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="utf-8" />
	<title>tobias-barth.net | Moderne Webentwicklung aus Köln</title>
	<meta name="description" content="" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="stylesheet" href="/css/style.min.css" />
	<!--[if lt IE 9]>
		<link rel="stylesheet" href="/css/old-ie.min.css" />
	<![endif]-->

	<link rel="alternate" type="application/rss+xml" href="/blog/feed/rss.xml" />

</head>
<body>
	<header class="site-head">
			<a href="/"><h1 class="in-site-head">tobias-barth.net</h1>
			<p class="tagline in-site-head">Moderne Webentwicklung aus Köln</p></a>
		</header>


		<main>
			<nav class="main-navi" id="main-navi">
				<ul>
					<li><a href="/portfolio" title="Meine Fähigkeiten, Arbeitsfelder und Beispielprojekte"><span class="fa fa-wrench"></span> Ich mache</a></li>
				<li><a href="/blog" title="Mein Blog über Webentwicklung und Ähnliches"><span class="fa fa-pencil"></span> Ich schreibe</a></li>
<!--					<li><a href="" title="Lernen Sie mich besser kennen"><span class="fa fa-user"></span> Ich bin</a></li>-->
				</ul>
			</nav>
		<div class="blog-textcontainer">
<article id="Check-types-and-emit-type-declarations" class="blog-post">
	<header class="blog-post-header">
	
		<h2 class="blog-post-title">Check types and emit type declarations</h2>
	
	<p class="blog-post-date">Geschrieben am <time datetime="2019-10-31T18:59:48.000Z">31. Oktober 2019</time></p>
	</header>
	<div class="blog-post-content">
		<h3 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h3><p>This article is part 5 of the series “Publish a modern JavaScript (or TypeScript) library”. Check out the motivation and links to other parts <a href="http://tobias-barth.net/blog/2019/07/Publish-a-modern-JavaScript-or-TypeScript-library/">in the introduction</a>.</p>
<h3 id="Getting-the-types-out-of-TypeScript"><a href="#Getting-the-types-out-of-TypeScript" class="headerlink" title="Getting the types out of TypeScript"></a>Getting the types out of TypeScript</h3><p>Ok, this is a quick one. When we build our library, we want two things from TypeScript: First we want to know that there are no type errors in our code (or types missing, e.g. from a dependency). Second, since we are publishing a library for other fellow coders to use, not an application, we want to export type declarations. We will start with type checking.</p>
<h3 id="Type-checking"><a href="#Type-checking" class="headerlink" title="Type-checking"></a>Type-checking</h3><p>Type-checking can be seen as a form of testing. Take the code and check if certain assertions hold. Therefore, we want to be able to execute it as a separate thing that we can add to our build chain or run it in a pre-commit hook for example. You don’t necessarily want to generate type definition files every time you (or your CI tool) run your tests.</p>
<p>If you want to follow along with my <a href="https://github.com/4nduril/library-starter/tree/typescript">little example library</a>, be sure to check out one of the <code>typescript</code> branches.</p>
<p>The TypeScript Compiler always checks the types of a project it runs on. And it will fail and report errors if there are any. So in principle we could just run <code>tsc</code> to get what we want. Now, to separate creating output files from the pure checking process, we must give <code>tsc</code> a handy option:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">tsc</span> --<span class="literal">no</span>Emit</span><br></pre></td></tr></table></figure>
<p>Regardless if we use Babel or TSC for transpiling, for checking types there is just this one way.</p>
<h3 id="Create-type-declaration-files"><a href="#Create-type-declaration-files" class="headerlink" title="Create type declaration files"></a>Create type declaration files</h3><p>This is something pretty library-specific. When you build an application in TypeScript, you only care about correct types and an executable output. But when you provide a library, your users (i.e. other programmers) can directly benefit from the fact that you wrote it in TypeScript. When you provide type declaration files (<code>*.d.ts</code>) the users will get better auto-completion, type-hints and so on when they use your lib.</p>
<p>Maybe you have heard about <a href="https://www.definitelytyped.org/">DefinitelyTyped</a>. Users can get types from there for libraries that don’t ship with their own types. So, in our case we won’t need to do anything with or for DefinitelyTyped. Consumers of our library will have everything they need when we deliver types directly with our code.</p>
<p>Again, because these things are core functionality of TypeScript, we use <code>tsc</code>. But this time the calls are slightly different depending on how we transpile – with Babel or TSC.</p>
<h4 id="With-Babel"><a href="#With-Babel" class="headerlink" title="With Babel"></a>With Babel</h4><p>As you probably remember, to create our output files with Babel, we call the Babel command line interface, <code>babel</code>. To also get declaration files we add a call to <code>tsc</code>:</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">tsc</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">declaration</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">emitDeclarationOnly</span></span><br></pre></td></tr></table></figure>
<p>The <code>--declaration</code> flag ensures that TSC generates the type declaration files and since we defined the <code>outputDir</code> in <code>tsconfig.json</code>, they land in the correct folder <code>dist/</code>.</p>
<p>The second flag, <code>--emitDeclarationOnly</code>, prevents TSC from outputting transpiled JavaScript files. We use Babel for that.</p>
<p>You may ask yourself why we effectively transpile all of our code twice, once with Babel and once with TSC. It looks like a waste of time if TSC can do both. But <a href="http://tobias-barth.net/blog/2019/07/Compiling-modern-language-features-with-the-TypeScript-compiler/">I discussed before</a> the advantages of Babel. And having a very fast transpile step separate from a slower declaration generation step can translate to a much better developer experience. The output of declarations can occur only once shortly before publishing – transpiling is something that you do all the time.</p>
<h4 id="With-TSC"><a href="#With-TSC" class="headerlink" title="With TSC"></a>With TSC</h4><p>When we use TSC to generate the published library code, we can use it <em>in the same step</em> to spit out the declarations. Instead of just <code>tsc</code>, we call:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc <span class="comment">--declaration</span></span><br></pre></td></tr></table></figure>
<p>That is all.</p>
<h3 id="Alias-All-The-Things"><a href="#Alias-All-The-Things" class="headerlink" title="Alias All The Things"></a>Alias All The Things</h3><p>To make it easier to use and less confusing to find out what our package can do, we will create NPM scripts for all steps that we define. Then we can glue them together so that for example <code>npm run build</code> will always do everything we want from our build.</p>
<p>In the case of using Babel, in our <code>package.json</code> we make sure that <code>&quot;scripts&quot;</code> contains at least:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"check-types"</span>: <span class="string">"tsc --noEmit"</span>,</span><br><span class="line">    <span class="string">"emit-declarations"</span>: <span class="string">"tsc --declaration --emitDeclarationOnly"</span>,</span><br><span class="line">    <span class="string">"transpile"</span>: <span class="string">"babel -d dist/ --extensions .ts,.tsx src/"</span>,</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"npm run emitDeclarations &amp;&amp; npm run transpile"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And if you are just using TSC, it looks like this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"check-types"</span>: <span class="string">"tsc --noEmit"</span>,</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"tsc --declaration"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that we don’t add <code>check-types</code> to <code>build</code>. First of all building and testing are two very different things. We don’t want to mix them explicitly. And second, in both cases we <em>do</em> check the types on build. Because as I said: that happens every time you call <code>tsc</code>. So even if you are slightly pedantic about type-checking on build, you don’t have to call <code>check-types</code> within the build script.</p>
<p>One great advantage of aliasing every action to a NPM script is that everyone working on your library (including you) can just run <code>npm run</code> and will get a nice overview of what scripts are available and what they do.</p>
<p>That’s it for using types.</p>
<p>Next up: All about bundling.</p>

	</div>
</article>

</div>

		</main>
	<footer class="site-footer h-card" aria-describedby="dse">
		<h3 class="in-site-footer cta">Kontaktieren Sie mich</h3>
		<p class="in-site-footer">Email: <a href="mailto:contact@tobias-barth.net" rel="me" class="u-email">contact@tobias-barth.net</a><br />
		Telefon: <a href="tel:+4915111215929">+49 151 112 15 929</a></p>
		<p id="dse" class="in-site-footer">(Bitte beachten Sie vor der Kontaktaufnahme meine Datenschutzerklärung.)</p>
		<h3 class="in-site-footer cta">Finden Sie mich</h3>
		<p class="in-site-footer"><img class="sm u-photo" src="/images/Portrait.png" alt="Mein Avatar" /><a class="sm fa fa-adn" href="https://alpha.app.net/4nduril" rel="me"><span>App.net</span></a> <a class="sm fa fa-twitter" href="https://twitter.com/4nduril" rel="me"><span>Twitter</span></a> <a class="sm fa fa-github-square" href="https://github.com/4nduril" rel="me"><span>Github</span></a></p>
		<h3 class="in-site-footer">Impressum</h3>
		<p class="in-site-footer">Inhaltlich verantwortlich gemäß § 5 <abbr title="Telemediengesetz">TMG</abbr>:<br />
		<a href="http://tobias-barth.net" class="p-name u-url">Tobias&nbsp;Barth</a><br />
		<span class="p-street-address">Vincenzstr.&nbsp;25</span><br />
		<span class="p-locality p-postal-code">51065&nbsp;Köln</span></p>
		<p class="in-site-footer">USt-ID: DE304359556</p>
		<h4 class="in-site-footer">Fotos</h4>
		<p class="in-site-footer">&copy;&nbsp;<a href="http://annebarth.de">Anne&nbsp;Barth</a></p>
		<p class="in-site-footer"><a href="dse.html">Datenschutzerklärung</a></p>
	</footer>
</body>

</html>
